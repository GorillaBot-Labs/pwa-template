language: node

node_js:
  - $TRAVIS_NODE_VERSION # uses .nvmrc as default
  -
addons:
  apt:
    packages:
      # Ubuntu 16+ does not install this dependency by default, so we need to install it ourselves
      - libgconf-2-4
      -
before_install:
  # install yarn
  - npm install -g yarn

install: yarn install --frozen-lockfile

cache:
  yarn: true

jobs:
  include:
    - stage: "Build"
      script: yarn client:build
    - stage: "Tests"
      script: yarn client:test
    - script: yarn server:test
    - env:
        #https://github.com/cypress-io/cypress/issues/2634#issuecomment-542158506
        - CYPRESS_CACHE_FOLDER=cache/Cypress
      script: yarn cy:test
    - stage: "Cleanup"
      # after all tests finish running we need
      # to kill all background jobs (i.e. server)
      script: kill $(jobs -p) || true
